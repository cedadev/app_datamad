---
apiVersion: backstage.io/v1alpha1
kind: System
metadata:
  name: DataMAD
  description: "DataMAD is a NERC system for managing NERC grants and data archiving amongst the NERC datacentres."
  tags:
    - "priority:high"
    - "visibility:public"
    - "manager:matthew-paice"
    - "deputy-manager:sam-pepler"
    - "review:passed"
    - "host:rancher-jasmin-production"
  links: 
    - url: https://cedadev.github.io/datamad2/
      title: "DataMAD user documentation"
      icon: externalLink
    - url: https://datamad.ceda.ac.uk
      title: "DataMAD Service"
      icon: externalLink
spec:
  owner: group:default/developers
  domain: domain:default/ceda-systems
  lifecycle: production
  dependsOn:
    - component:app-datamad
    - resource:default/elasticsearch-index-datamad
    - resource:default/DataMAD-database
    - component:default/datamad-deploy
    - component:default/databank-schema
    - component:default/sra_dw-schema

---
apiVersion: backstage.io/v1alpha1
kind: Component
metadata:
  name: app-datamad
  description: "Cluster architecture for Rancher Kubernetes clusters, including load-balancing and ingress details."
  tags:
    - "priority:high"
    - "visibility:public"
    - "manager:matthew-paice"
    - "deputy-manager:sam-pepler"
    - "review:passed"
  annotations:
    backstage.io/techdocs-ref: dir:.
spec:
  type: kubernetes
  owner: group:default/developers
  system: system:default/DataMAD
  dependencyOf: 
    - system:default/DataMAD
  dependsOn:
    - component:default/datamad-deploy
    - resource:default/elasticsearch-index-datamad
    - resource:default/DataMAD-database
    - component:default/databank-schema
    - component:default/sra_dw-schema
  lifecycle: production

---
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: elasticsearch-index-datamad
  description: The elasticsearch index (datamad2-haystack) used for Django Haystack to store and quickly retrieve DataMAD search results
  tags:
    - "priority:high"
    - "visibility:public"
    - "manager:matthew-paice"
    - "deputy-manager:rhys-evans"
    - "review:passed"
    - "host:unknown"
spec:
  type: database
  owner: group:default/developers
  system: system:default/DataMAD
  lifecycle: production
  dependsOn:
    - system:default/elasticsearch-deployment
  dependencyOf: 
    - system:default/DataMAD

---
apiVersion: backstage.io/v1alpha1
kind: Resource
metadata:
  name: DataMAD-database
  description: The DataMAD Database
  tags:
    - "priority:high"
    - "visibility:public"
    - "manager:andrew-harwood"
    - "review:passed"
    - "host:db6"
spec:
  type: database
  owner: group:default/developers
  system: system:default/DataMAD
  dependsOn: 
    - component:default/db6
  dependencyOf: 
    - system:default/DataMAD
  lifecycle: production
