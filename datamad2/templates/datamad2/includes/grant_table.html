{% load routing_classification_icon %}

<table class="row-border" id="grants" style="width:100%">
    <thead>
    <tr>
        <th>Grant Reference</th>
        <th>Title</th>
        <th>PI</th>
        <th>Routing Classification</th>
        <th>Date Added</th>
        <th>Claim Status</th>
    </tr>
    </thead>
    <tbody>
    {% for grant in grants %}
        {% with imported_grant=grant.importedgrant_set.first %}
            <tr>
                <td>
                    <a href="{% url 'grant_detail' pk=imported_grant.pk %}">
                        {{ imported_grant.grant_ref }}
                    </a>
                </td>
                <td> {{ imported_grant.title }}</td>
                <td> {{ imported_grant.grant_holder }}</td>
{#                {% if imported_grant.routing_classification in imported_grant.routing_classification.choices %}#}
                    {% if imported_grant.routing_classification is not None %}
                    <td data-sort="{{ imported_grant.routing_classification }} ">
                            {{ imported_grant.routing_classification}}</td>
{#                    {%  endif %}#}
                    {% elif imported_grant.get_science_area is not None %}

                    {%  with areas=imported_grant.get_science_area %}
                        <td data-sort="{{ areas|first }} ">
                    {% for area in areas %}
                      {{ area }}
                    {% endfor %}
                        </td>
                    {% endwith %}
                {% else %}
                    <td data-sort="z"> {{ imported_grant.routing_classification }}
                    </td>
                {% endif %}
                <td> {{ imported_grant.creation_date|date:"d M Y" }}</td>
                {% if imported_grant.grant.claimed == True %}
                    <td id="claim"> CLAIMED</td>
                {% else %}
                    <td>
                        <button data-id="{{ imported_grant.grant.pk }}" data-user="{{ user.data_centre.name }}"
                                class="btn btn-primary claim-btn" id="claim-button"> CLAIM
                        </button>
                    </td>
                {% endif %}
            </tr>
        {% endwith %}
    {% endfor %}
    </tbody>
</table>